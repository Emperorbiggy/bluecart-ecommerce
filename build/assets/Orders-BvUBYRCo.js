import{r as c,a as h,j as e}from"./app-DsG4s4m7.js";import{A as v}from"./AdminLayout-DMB7km8s.js";import"./BlueCartLoader-BFcnrs0R.js";import"./createLucideIcon-d2gaGFPv.js";import"./log-out-DPietjih.js";import"./user-Cmw1jrZ6.js";import"./api-Mjd8Mpow.js";function L(){var p;const[u,m]=c.useState([]),[s,o]=c.useState(null),[g,b]=c.useState("orders"),[j,y]=c.useState(!0);c.useEffect(()=>{f()},[]);const f=async()=>{try{const t=localStorage.getItem("auth_token"),a=await h.get("/api/admin/orders",{headers:{Authorization:`Bearer ${t}`}});m(a.data.orders)}catch(t){console.error("Failed to load orders:",t)}finally{y(!1)}},l=async(t,a)=>{try{const r=localStorage.getItem("auth_token"),n=(await h.patch(`/api/orders/${t}/status`,{status:a},{headers:{Authorization:`Bearer ${r}`}})).data.order;m(i=>i.map(d=>d.id===n.id?n:d)),o(null)}catch(r){console.error("Failed to update order:",r),alert("Failed to update order status")}},N=t=>{const a=t.payment_method==="cod",r=t.status.toLowerCase();if(t.payment_status.toLowerCase(),a){if(r==="pending")return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>l(t.id,"rejected"),className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Reject"}),e.jsx("button",{onClick:()=>l(t.id,"processing"),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Accept"})]});if(r==="processing")return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>l(t.id,"rejected"),className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Reject"}),e.jsx("button",{onClick:()=>l(t.id,"completed"),className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:"Complete"})]})}else if(r==="processing")return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>l(t.id,"refunded"),className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Refund"}),e.jsx("button",{onClick:()=>l(t.id,"completed"),className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:"Complete"})]});return null};return e.jsx(v,{activeTab:g,setActiveTab:b,children:e.jsxs("div",{className:"max-w-6xl mx-auto p-4",children:[e.jsx("h2",{className:"text-3xl font-bold text-[#130447] mb-6",children:"All Orders"}),j?e.jsx("p",{children:"Loading orders..."}):e.jsx("div",{className:"overflow-x-auto bg-white shadow-md rounded-lg",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-[#130447] text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Order ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Customer"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:u.map(t=>{var a;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-4 py-3 font-medium text-[#130447]",children:["#",t.order_id]}),e.jsx("td",{className:"px-4 py-3",children:(a=t.user)==null?void 0:a.name}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold text-white ${t.status==="completed"?"bg-green-600":t.status==="processing"?"bg-blue-600":t.status==="pending"?"bg-yellow-500":t.status==="rejected"?"bg-red-600":t.status==="refunded"?"bg-gray-600":"bg-gray-400"}`,children:t.status.toUpperCase()})}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[e.jsxs("span",{className:"block",children:[e.jsx("b",{children:"Method:"})," ",t.payment_method.toUpperCase()]}),e.jsxs("span",{children:[e.jsx("b",{children:"Status:"})," ",t.payment_status.toUpperCase()]})]}),e.jsxs("td",{className:"px-4 py-3",children:["₦",Number(t.total_price).toLocaleString()]}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("button",{onClick:()=>o(t),className:"text-[#130447] hover:underline font-semibold",children:"View"})})]},t.id)})})]})}),s&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl relative shadow-xl",children:[e.jsx("button",{onClick:()=>o(null),className:"absolute top-2 right-3 text-gray-500 hover:text-red-600 text-xl",children:"×"}),e.jsxs("h3",{className:"text-2xl font-bold mb-4 text-[#130447]",children:["Order #",s.order_id," – ",(p=s.user)==null?void 0:p.name]}),e.jsxs("div",{className:"mb-4 text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{children:[e.jsx("b",{children:"Payment Method:"})," ",s.payment_method.toUpperCase()]}),e.jsxs("p",{children:[e.jsx("b",{children:"Payment Status:"})," ",s.payment_status.toUpperCase()]}),e.jsxs("p",{children:[e.jsx("b",{children:"Order Status:"})," ",s.status.toUpperCase()]}),e.jsxs("p",{children:[e.jsx("b",{children:"VAT:"})," ₦",Number(s.vat).toLocaleString()]})]}),e.jsx("div",{className:"space-y-3 max-h-72 overflow-y-auto border-t pt-4",children:s.items.map(t=>{var x,n,i,d;const r=(typeof((x=t.product)==null?void 0:x.images)=="string"?JSON.parse(t.product.images):((n=t.product)==null?void 0:n.images)||[])[0];return e.jsxs("div",{className:"flex items-center space-x-4 border-b pb-2",children:[e.jsx("img",{src:r||"/placeholder.png",className:"w-16 h-16 object-cover rounded",alt:((i=t.product)==null?void 0:i.name)||"Product"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:(d=t.product)==null?void 0:d.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["₦",Number(t.unit_price).toLocaleString()," × ",t.quantity]}),e.jsxs("p",{className:"text-sm font-semibold text-[#130447]",children:["Total: ₦",Number(t.total_price).toLocaleString()]})]})]},t.id)})}),e.jsx("div",{className:"flex justify-end gap-4 mt-6",children:N(s)})]})})]})})}export{L as default};
