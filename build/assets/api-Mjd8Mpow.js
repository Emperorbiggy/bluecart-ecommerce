import{a as g}from"./app-DsG4s4m7.js";const l="/api",a={login:"/login",logout:"/logout",me:"/me",profileUpdate:"/profile/update",permits:"/permits",products:"/products",createOrder:"/orders",payments:"/payments/verify",register:"/register",getOrders:"/orders",checkRole:"/user/role",relatedProducts:e=>`/products/${e}/related`},d={login:"/login",register:"/register",dashboard:"/dashboard",adminDashboard:"/admin/dashboard",forgotPassword:"/forgot-password",products:"/products"},s=g.create({baseURL:l,headers:{Accept:"application/json","Content-Type":"application/json"}}),c=e=>{e?s.defaults.headers.common.Authorization=`Bearer ${e}`:delete s.defaults.headers.common.Authorization},u=()=>{const e=localStorage.getItem("auth_token");e&&c(e)};u();const y=async({email:e,password:t})=>{const r=await s.post(a.login,{email:e,password:t}),{access_token:o,user:n}=r.data;o&&(localStorage.setItem("auth_token",o),c(o));const i=(n==null?void 0:n.role)==="admin"?d.adminDashboard:d.dashboard;window.location.href=i},f=async()=>{const e=localStorage.getItem("auth_token");if(!e)throw new Error("No auth token found. Please log in.");c(e);try{return(await s.get(a.me)).data}catch(t){throw console.error("Error fetching current user:",t),t}},w=async()=>{const e=localStorage.getItem("auth_token");if(!e)throw new Error("No auth token found.");return c(e),(await s.get(a.getOrders)).data.orders},k=async()=>{const e=localStorage.getItem("auth_token");if(!e)throw new Error("No auth token found. Please log in.");c(e);try{return(await s.get(a.checkRole)).data}catch(t){throw console.error("Error fetching user role:",t),t}},I=async({items:e,paymentMethod:t,vat:r,totalPrice:o})=>{const n=localStorage.getItem("auth_token");if(!n)throw new Error("No auth token found. Please log in.");c(n);const i={items:e.map(p=>({product_id:p.product_id,quantity:p.quantity,unit_price:p.price})),total_price:o,vat:r,payment_method:t};return(await s.post(a.createOrder,i)).data};async function P(e){try{const t=await s.post(a.payments,{reference:e});return console.log("✅ Payment verification response:",t),t.data}catch(t){throw console.error("❌ Error verifying payment:",t.response||t.message||t),t}}const _=async()=>{try{return(await s.get(a.products)).data.products.map(r=>({...r,images:typeof r.images=="string"?JSON.parse(r.images):r.images}))}catch(e){throw console.error("Error fetching products:",e),e}},E=async e=>{try{return(await s.get(a.relatedProducts(e))).data.map(o=>({...o,images:typeof o.images=="string"?JSON.parse(o.images):o.images}))}catch(t){throw console.error("Error fetching related products:",t),t}},S=async e=>{try{const r=(await s.get(`${a.products}/${e}`)).data.product;return{...r,images:typeof r.images=="string"?JSON.parse(r.images):r.images}}catch(t){throw console.error("Error fetching product by ID:",t),t}},b=async e=>{var r;const t=localStorage.getItem("auth_token");if(!t)throw new Error("No auth token found. Please log in.");if(c(t),e.imageInputType==="upload"&&((r=e.uploadedImages)!=null&&r.length)){const o=new FormData;return o.append("name",e.name),o.append("price",e.price),o.append("discount",e.discount||0),o.append("category",e.category),o.append("shortDescription",e.shortDescription||""),o.append("details",e.details||""),o.append("imageInputType","upload"),e.uploadedImages.forEach(n=>{o.append("uploadedImages[]",n)}),s.post(a.products,o,{headers:{"Content-Type":"multipart/form-data"}})}else{const o={name:e.name,price:e.price,discount:e.discount||0,category:e.category,shortDescription:e.shortDescription||"",details:e.details||"",imageInputType:"url",images:e.images||[]};return s.post(a.products,o)}},N=async(e,t)=>{try{const r=localStorage.getItem("auth_token");if(!r)throw new Error("No auth token found. Please log in.");c(r);let o;return t instanceof FormData?o=await s.post(`${a.products}/${e}?_method=PUT`,t,{headers:{"Content-Type":"multipart/form-data"}}):o=await s.put(`${a.products}/${e}`,t),o.data}catch(r){throw console.error("Error updating product:",r),r}};export{b as a,s as b,a as c,I as d,k as e,f,_ as g,S as h,E as i,w as j,y as l,c as s,N as u,P as v,d as w};
